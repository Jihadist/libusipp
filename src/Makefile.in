# USI++ Makefile
#

LIBS=@LIBS@
LDFLAGS=@LDFLAGS@
DEFS=
CXXFLAGS=@CXXFLAGS@ -I/usr/include/pcap -I. -I.. -Wall -c -ansi -std=c++11 $(DEFS)
CXX=@CXX@
CC=@CC@
INSTALL=@INSTALL@
RANLIB=@RANLIB@

all: usi++

clear:
	rm -f *.o

usi++: icmp.o datalink.o ip.o misc.o udp.o tcp.o TX_IP.o Layer2.o arp.o eapol.o ip6.o\
	 TX_IP6.o icmp6.o TX_dnet_ip.o TX_dnet_eth.o TX_pcap_eth.o TX_pcap.o object.o
	ar cr libusi++.a $^
	$(CC) $^ -shared -o libusi++.so
	$(RANLIB) libusi++.a
#	rm -f *.o

object.o: object.cc
	$(CXX) $(CXXFLAGS) $<

TX_pcap.o: TX_pcap.cc
	$(CXX) $(CXXFLAGS) $<

TX_pcap_eth.o: TX_pcap_eth.cc
	$(CXX) $(CXXFLAGS) $<

TX_dnet_eth.o: TX_dnet_eth.cc
	$(CXX) $(CXXFLAGS) $<

TX_dnet_ip.o: TX_dnet_ip.cc
	$(CXX) $(CXXFLAGS) $<

icmp6.o: icmp6.cc
	$(CXX) $(CXXFLAGS) $<

TX_IP6.o: TX_IP6.cc
	$(CXX) $(CXXFLAGS) $<

ip6.o: ip6.cc
	$(CXX) $(CXXFLAGS) $<

arp.o: arp.cc
	$(CXX) $(CXXFLAGS) $<

eapol.o: eapol.cc
	$(CXX) $(CXXFLAGS) $<

datalink.o: datalink.cc
	$(CXX) $(CXXFLAGS) $<

icmp.o: icmp.cc
	$(CXX) $(CXXFLAGS) $<

ip.o: ip.cc
	$(CXX) $(CXXFLAGS) $<

misc.o: misc.cc
	$(CXX) $(CXXFLAGS) $<

udp.o: udp.cc
	$(CXX) $(CXXFLAGS) $<

tcp.o: tcp.cc
	$(CXX) $(CXXFLAGS) $<

Layer2.o: Layer2.cc
	$(CXX) $(CXXFLAGS) $<

TX_IP.o: TX_IP.cc
	$(CXX) $(CXXFLAGS) $<

install:
	$(INSTALL) -g bin -o root -m 0755 libusi++.* /usr/lib
	mkdir -m 0755 /usr/include/usi++||true
	cp -R ../usi++/* /usr/include/usi++
	chown -R root /usr/include/usi++
	ldconfig||true
	@echo To build programs using libusi++, you have to do \'c++ foo.cc -lusi++ $(LIBS) $(LDFLAGS)\'

uninstall:
	rm -f /usr/lib/libusi++.a
	rm -f /usr/lib/libusi++.so
	rm -rf /usr/include/usi++

clean:
	rm -f *.o *.a

